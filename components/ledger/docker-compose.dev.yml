services:
  ledger:
    container_name: midaz-ledger-dev
    restart: unless-stopped
    build:
      context: ../../
      dockerfile: ./components/ledger/Dockerfile.dev
    env_file:
      - .env
    environment:
      - ENV_NAME=development
      - CGO_ENABLED=0
    ports:
      - ${SERVER_PORT}:${SERVER_PORT}
    volumes:
      # Mount full monorepo for watching all Go code
      - ../../:/app
      # Preserve go module cache for faster rebuilds
      - go-mod-cache:/go/pkg/mod
      # Preserve go build cache
      - go-build-cache:/root/.cache/go-build
    networks:
      - infra-network
      - ledger-network

volumes:
  go-mod-cache:
  go-build-cache:

networks:
  infra-network:
    name: infra-network
    driver: bridge
    external: true
  ledger-network:
    name: ledger-network
    driver: bridge
